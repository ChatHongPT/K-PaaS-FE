import React, { useState } from 'react';
import styled from 'styled-components';
import { COLORS } from '../../constants';
import MainHeader from '../MainHeader';
import MainFooter from '../MainFooter';

const QuizContainer = styled.div`
  min-height: 100vh;
  background: #f8f9fa;
`;

const QuizContent = styled.main`
  max-width: 800px;
  margin: 0 auto;
  padding: 2rem;
  
  @media (max-width: 768px) {
    padding: 1rem;
  }
`;

const QuizHeader = styled.div`
  text-align: center;
  margin-bottom: 3rem;
`;

const QuizTitle = styled.h1`
  font-size: 2.5rem;
  font-weight: 700;
  color: #1f2937;
  margin-bottom: 1rem;
  
  @media (max-width: 768px) {
    font-size: 2rem;
  }
`;

const QuizSubtitle = styled.p`
  font-size: 1.1rem;
  color: #6b7280;
  line-height: 1.6;
`;

const QuizSection = styled.section`
  background: white;
  border-radius: 16px;
  padding: 2.5rem;
  margin-bottom: 2rem;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  
  @media (max-width: 768px) {
    padding: 1.5rem;
  }
`;

const SectionTitle = styled.h2`
  font-size: 1.8rem;
  font-weight: 600;
  color: #1f2937;
  margin-bottom: 1.5rem;
  display: flex;
  align-items: center;
  gap: 0.8rem;
  
  @media (max-width: 768px) {
    font-size: 1.5rem;
  }
`;

const SectionIcon = styled.span`
  background: ${COLORS.primary};
  color: white;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
`;

const QuizCard = styled.div`
  background: white;
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  padding: 2rem;
  margin-bottom: 2rem;
  transition: all 0.3s ease;
  
  &:hover {
    border-color: ${COLORS.primary};
    box-shadow: 0 4px 12px rgba(5, 150, 105, 0.1);
  }
`;

const QuestionNumber = styled.div`
  background: ${COLORS.primary};
  color: white;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 0.9rem;
  margin-bottom: 1rem;
`;

const QuestionText = styled.h3`
  font-size: 1.2rem;
  font-weight: 600;
  color: #1f2937;
  margin-bottom: 1.5rem;
  line-height: 1.5;
`;

const OptionsList = styled.div`
  display: flex;
  flex-direction: column;
  gap: 0.8rem;
`;

const OptionButton = styled.button<{ $isSelected: boolean; $isCorrect?: boolean; $showResult: boolean }>`
  background: ${props => {
    if (props.$showResult) {
      if (props.$isCorrect) return '#f0fdf4';
      if (props.$isSelected && !props.$isCorrect) return '#fef2f2';
      return '#f8f9fa';
    }
    return props.$isSelected ? '#ecfdf5' : 'white';
  }};
  border: 2px solid ${props => {
    if (props.$showResult) {
      if (props.$isCorrect) return '#10b981';
      if (props.$isSelected && !props.$isCorrect) return '#ef4444';
      return '#e5e7eb';
    }
    return props.$isSelected ? COLORS.primary : '#e5e7eb';
  }};
  color: ${props => {
    if (props.$showResult) {
      if (props.$isCorrect) return '#059669';
      if (props.$isSelected && !props.$isCorrect) return '#dc2626';
      return '#374151';
    }
    return props.$isSelected ? COLORS.primary : '#374151';
  }};
  padding: 1rem 1.5rem;
  border-radius: 8px;
  text-align: left;
  cursor: ${props => props.$showResult ? 'default' : 'pointer'};
  transition: all 0.3s ease;
  font-size: 1rem;
  line-height: 1.5;
  
  &:hover {
    ${props => !props.$showResult && `
      border-color: ${COLORS.primary};
      background: #ecfdf5;
    `}
  }
  
  &:disabled {
    cursor: default;
  }
`;

const ResultIcon = styled.span`
  margin-right: 0.5rem;
  font-weight: 700;
`;

const Explanation = styled.div<{ $isCorrect: boolean }>`
  background: ${props => props.$isCorrect ? '#f0fdf4' : '#fef2f2'};
  border: 1px solid ${props => props.$isCorrect ? '#10b981' : '#ef4444'};
  border-radius: 8px;
  padding: 1rem;
  margin-top: 1rem;
  color: ${props => props.$isCorrect ? '#059669' : '#dc2626'};
  font-size: 0.9rem;
  line-height: 1.5;
`;

const QuizControls = styled.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 2rem;
  
  @media (max-width: 768px) {
    flex-direction: column;
    gap: 1rem;
  }
`;

const ControlButton = styled.button`
  background: ${COLORS.primary};
  color: white;
  border: none;
  padding: 0.8rem 1.5rem;
  border-radius: 8px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  
  &:hover {
    background: #10b981;
    transform: translateY(-2px);
  }
  
  &:disabled {
    background: #9ca3af;
    cursor: not-allowed;
    transform: none;
  }
`;

const SecondaryButton = styled.button`
  background: white;
  color: ${COLORS.primary};
  border: 2px solid ${COLORS.primary};
  padding: 0.8rem 1.5rem;
  border-radius: 8px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  
  &:hover {
    background: ${COLORS.primary};
    color: white;
  }
`;

const ProgressBar = styled.div`
  width: 100%;
  height: 8px;
  background: #e5e7eb;
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 2rem;
`;

const ProgressFill = styled.div<{ $progress: number }>`
  height: 100%;
  background: ${COLORS.primary};
  width: ${props => props.$progress}%;
  transition: width 0.3s ease;
`;

const ScoreDisplay = styled.div`
  text-align: center;
  margin-bottom: 2rem;
`;

const ScoreText = styled.div`
  font-size: 1.5rem;
  font-weight: 600;
  color: #1f2937;
  margin-bottom: 0.5rem;
`;

const ScoreSubtext = styled.div`
  color: #6b7280;
  font-size: 1rem;
`;

const QuizData = [
  {
    id: 1,
    question: "Í∑ºÎ°úÍ≥ÑÏïΩÏÑúÏóêÏÑú Í∑ºÎ°úÏãúÍ∞ÑÏùÑ 'ÌöåÏÇ¨ ÎÇ¥Í∑úÏóê Îî∞Î¶Ñ'ÏúºÎ°ú Í∏∞Ïû¨ÌïòÎäî Í≤ÉÏùÄ Ï†ÅÏ†àÌïúÍ∞ÄÏöî?",
    options: [
      "ÎÑ§, Ï†ÅÏ†àÌï©ÎãàÎã§",
      "ÏïÑÎãàÏöî, Íµ¨Ï≤¥Ï†ÅÏúºÎ°ú Î™ÖÏãúÌï¥Ïïº Ìï©ÎãàÎã§",
      "ÏÉÅÌô©Ïóê Îî∞Îùº Îã§Î¶ÖÎãàÎã§",
      "Î≤ïÏ†Å ÏöîÍ±¥Ïù¥ ÏïÑÎãàÎØÄÎ°ú ÏÉùÎûµ Í∞ÄÎä•Ìï©ÎãàÎã§"
    ],
    correctAnswer: 1,
    explanation: "Í∑ºÎ°úÏãúÍ∞ÑÏùÄ Íµ¨Ï≤¥Ï†ÅÏúºÎ°ú Î™ÖÏãúÌï¥Ïïº Ìï©ÎãàÎã§. 'ÌöåÏÇ¨ ÎÇ¥Í∑úÏóê Îî∞Î¶Ñ'Í≥º Í∞ôÏùÄ Î™®Ìò∏Ìïú ÌëúÌòÑÏùÄ Î∂ÑÏüÅÏùò ÏõêÏù∏Ïù¥ Îê† Ïàò ÏûàÏúºÎØÄÎ°ú ÌîºÌï¥Ïïº Ìï©ÎãàÎã§."
  },
  {
    id: 2,
    question: "Ïó∞Î¥â 3,000ÎßåÏõêÏùÑ Î∞õÎäî Í∑ºÎ°úÏûêÏùò ÏõîÍ∏â Íµ¨ÏÑ±ÏúºÎ°ú Ïò¨Î∞îÎ•∏ Í≤ÉÏùÄ?",
    options: [
      "Ïõî 250ÎßåÏõê (Ïó∞Î¥âÏùò 1/12)",
      "Í∏∞Î≥∏Í∏â 200ÎßåÏõê + ÏàòÎãπ 50ÎßåÏõê",
      "Í∏∞Î≥∏Í∏â 180ÎßåÏõê + Ïó∞Ïû•ÏàòÎãπ 40ÎßåÏõê + ÏãùÎåÄ 30ÎßåÏõê",
      "Î™®Îì† Íµ¨ÏÑ±Ïù¥ Î™ÖÏãúÎêòÏñ¥Ïïº Ìï©ÎãàÎã§"
    ],
    correctAnswer: 3,
    explanation: "Ïó∞Î¥âÏùò Í≤ΩÏö∞ Í∏∞Î≥∏Í∏â, Ïó∞Ïû•ÏàòÎãπ, ÏãùÎåÄ Îì± ÏõîÍ∏âÏùò ÏÑ∏Î∂Ä Íµ¨ÏÑ±ÏùÑ Î™ÖÏãúÌï¥Ïïº Ìï©ÎãàÎã§. Îã®ÏàúÌûà Ïó∞Î¥âÏùò 1/12ÎßåÏúºÎ°úÎäî Î∂ÄÏ°±Ìï©ÎãàÎã§."
  },
  {
    id: 3,
    question: "Í∑ºÎ°úÍ≥ÑÏïΩÏÑúÎ•º ÏûëÏÑ±ÌïòÏßÄ ÏïäÏúºÎ©¥ Ïñ¥Îñ§ Ï≤òÎ≤åÏùÑ Î∞õÎÇòÏöî?",
    options: [
      "Í≤ΩÍ≥†Îßå Î∞õÏäµÎãàÎã§",
      "500ÎßåÏõê Ïù¥ÌïòÏùò Î≤åÍ∏à",
      "1,000ÎßåÏõê Ïù¥ÌïòÏùò Î≤åÍ∏à",
      "Ï≤òÎ≤åÏù¥ ÏóÜÏäµÎãàÎã§"
    ],
    correctAnswer: 1,
    explanation: "Í∑ºÎ°úÍ≥ÑÏïΩÏÑúÎ•º ÏÑúÎ©¥ÏúºÎ°ú Ï≤¥Í≤∞ÌïòÏßÄ ÏïäÍ±∞ÎÇò Í∑ºÎ°úÏûêÏóêÍ≤å ÍµêÎ∂ÄÌïòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞ 500ÎßåÏõê Ïù¥ÌïòÏùò Î≤åÍ∏àÏù¥ Î∂ÄÍ≥ºÎê©ÎãàÎã§."
  },
  {
    id: 4,
    question: "Ïó∞Ïû•Í∑ºÎ°ú ÏãúÍ∞ÑÏùò Î≤ïÏ†Å ÌïúÎèÑÎäî?",
    options: [
      "Ï£º 8ÏãúÍ∞Ñ",
      "Ï£º 12ÏãúÍ∞Ñ",
      "Ï£º 16ÏãúÍ∞Ñ",
      "Ï†úÌïúÏù¥ ÏóÜÏäµÎãàÎã§"
    ],
    correctAnswer: 1,
    explanation: "Í∑ºÎ°úÍ∏∞Ï§ÄÎ≤ï Ï†ú53Ï°∞Ïóê Îî∞Îùº 1Ï£º Í∞Ñ 12ÏãúÍ∞Ñ Ï¥àÍ≥º Í∑ºÎ¨¥Îäî Í∏àÏßÄÎê©ÎãàÎã§. Ïù¥Î•º Ï¥àÍ≥ºÌïòÎ©¥ Î≤ï ÏúÑÎ∞òÏóê Ìï¥ÎãπÌï©ÎãàÎã§."
  },
  {
    id: 5,
    question: "Ïó∞Ï∞® Ïú†Í∏âÌú¥Í∞ÄÎäî Ïñ∏Ï†ú Î∂ÄÏó¨ÎêòÎÇòÏöî?",
    options: [
      "ÏûÖÏÇ¨ Ï¶âÏãú",
      "1ÎÖÑÍ∞Ñ 80% Ïù¥ÏÉÅ Ï∂úÍ∑ºÌñàÏùÑ Í≤ΩÏö∞",
      "6Í∞úÏõî Í∑ºÎ¨¥ ÌõÑ",
      "ÌöåÏÇ¨ Ïû¨ÎüâÏóê Îî∞Îùº"
    ],
    correctAnswer: 1,
    explanation: "Í∑ºÎ°úÏûêÎäî 1ÎÖÑÍ∞Ñ 80% Ïù¥ÏÉÅ Ï∂úÍ∑ºÌñàÏùÑ Í≤ΩÏö∞ 15ÏùºÏùò Ïó∞Ï∞® Ïú†Í∏âÌú¥Í∞ÄÎ•º Î∞õÏùÑ Ïàò ÏûàÏäµÎãàÎã§."
  }
];

const ContractQuiz: React.FC = () => {
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [selectedAnswers, setSelectedAnswers] = useState<number[]>(new Array(QuizData.length).fill(-1));
  const [showResults, setShowResults] = useState(false);
  const [quizCompleted, setQuizCompleted] = useState(false);

  const handleAnswerSelect = (answerIndex: number) => {
    if (showResults) return;
    
    const newAnswers = [...selectedAnswers];
    newAnswers[currentQuestion] = answerIndex;
    setSelectedAnswers(newAnswers);
  };

  const handleNextQuestion = () => {
    if (currentQuestion < QuizData.length - 1) {
      setCurrentQuestion(currentQuestion + 1);
    }
  };

  const handlePreviousQuestion = () => {
    if (currentQuestion > 0) {
      setCurrentQuestion(currentQuestion - 1);
    }
  };

  const handleShowResults = () => {
    setShowResults(true);
    setQuizCompleted(true);
  };

  const handleRestartQuiz = () => {
    setCurrentQuestion(0);
    setSelectedAnswers(new Array(QuizData.length).fill(-1));
    setShowResults(false);
    setQuizCompleted(false);
  };

  const calculateScore = () => {
    let correct = 0;
    selectedAnswers.forEach((answer, index) => {
      if (answer === QuizData[index].correctAnswer) {
        correct++;
      }
    });
    return { correct, total: QuizData.length, percentage: Math.round((correct / QuizData.length) * 100) };
  };

  const progress = ((currentQuestion + 1) / QuizData.length) * 100;
  const score = calculateScore();

  return (
    <QuizContainer>
      <MainHeader />
      
      <QuizContent>
        <QuizHeader>
          <QuizTitle>Í∑ºÎ°úÍ≥ÑÏïΩÏÑú ÌÄ¥Ï¶à</QuizTitle>
          <QuizSubtitle>
            Í∑ºÎ°úÍ≥ÑÏïΩÏÑú ÏûëÏÑ±Ïóê ÎåÄÌïú Ïù¥Ìï¥ÎèÑÎ•º ÌÖåÏä§Ìä∏Ìï¥Î≥¥ÏÑ∏Ïöî
          </QuizSubtitle>
        </QuizHeader>

        <QuizSection>
          <SectionTitle>
            <SectionIcon>üß†</SectionIcon>
            ÌÄ¥Ï¶à ÏßÑÌñâ ÏÉÅÌô©
          </SectionTitle>
          
          <ProgressBar>
            <ProgressFill $progress={progress} />
          </ProgressBar>
          
          <div style={{ textAlign: 'center', marginBottom: '1rem' }}>
            <strong>Î¨∏Ï†ú {currentQuestion + 1} / {QuizData.length}</strong>
          </div>
        </QuizSection>

        <QuizCard>
          <QuestionNumber>{currentQuestion + 1}</QuestionNumber>
          <QuestionText>{QuizData[currentQuestion].question}</QuestionText>
          
          <OptionsList>
            {QuizData[currentQuestion].options.map((option, index) => (
              <OptionButton
                key={index}
                $isSelected={selectedAnswers[currentQuestion] === index}
                $isCorrect={index === QuizData[currentQuestion].correctAnswer}
                $showResult={showResults}
                onClick={() => handleAnswerSelect(index)}
                disabled={showResults}
              >
                {showResults && (
                  <ResultIcon>
                    {index === QuizData[currentQuestion].correctAnswer ? '‚úÖ' : 
                     selectedAnswers[currentQuestion] === index ? '‚ùå' : ''}
                  </ResultIcon>
                )}
                {option}
              </OptionButton>
            ))}
          </OptionsList>

          {showResults && (
            <Explanation $isCorrect={selectedAnswers[currentQuestion] === QuizData[currentQuestion].correctAnswer}>
              <strong>ÏÑ§Î™Ö:</strong> {QuizData[currentQuestion].explanation}
            </Explanation>
          )}
        </QuizCard>

        <QuizControls>
          <SecondaryButton 
            onClick={handlePreviousQuestion}
            disabled={currentQuestion === 0}
          >
            Ïù¥Ï†Ñ Î¨∏Ï†ú
          </SecondaryButton>

          {currentQuestion < QuizData.length - 1 ? (
            <ControlButton 
              onClick={handleNextQuestion}
              disabled={selectedAnswers[currentQuestion] === -1}
            >
              Îã§Ïùå Î¨∏Ï†ú
            </ControlButton>
          ) : (
            <ControlButton 
              onClick={handleShowResults}
              disabled={selectedAnswers[currentQuestion] === -1}
            >
              Í≤∞Í≥º Î≥¥Í∏∞
            </ControlButton>
          )}
        </QuizControls>

        {quizCompleted && (
          <QuizSection>
            <SectionTitle>
              <SectionIcon>üèÜ</SectionIcon>
              ÌÄ¥Ï¶à Í≤∞Í≥º
            </SectionTitle>
            
            <ScoreDisplay>
              <ScoreText>
                Ï†êÏàò: {score.correct} / {score.total} ({score.percentage}Ï†ê)
              </ScoreText>
              <ScoreSubtext>
                {score.percentage >= 80 ? 'üéâ ÌõåÎ•≠Ìï©ÎãàÎã§! Í∑ºÎ°úÍ≥ÑÏïΩÏÑúÏóê ÎåÄÌïú Ïù¥Ìï¥ÎèÑÍ∞Ä ÎÜíÏäµÎãàÎã§.' :
                 score.percentage >= 60 ? 'üëç ÏûòÌñàÏäµÎãàÎã§! Ï°∞Í∏à Îçî Í≥µÎ∂ÄÌïòÎ©¥ ÏôÑÎ≤ΩÌï† Í≤É Í∞ôÏäµÎãàÎã§.' :
                 'üìö Îçî Í≥µÎ∂ÄÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§. Í∑ºÎ°úÍ≥ÑÏïΩÏÑú Í∞ÄÏù¥ÎìúÎ•º Îã§Ïãú ÌïúÎ≤à ÌôïÏù∏Ìï¥Î≥¥ÏÑ∏Ïöî.'}
              </ScoreSubtext>
            </ScoreDisplay>

            <div style={{ textAlign: 'center' }}>
              <SecondaryButton onClick={handleRestartQuiz}>
                ÌÄ¥Ï¶à Îã§Ïãú ÌíÄÍ∏∞
              </SecondaryButton>
            </div>
          </QuizSection>
        )}
      </QuizContent>
      
      <MainFooter />
    </QuizContainer>
  );
};

export default ContractQuiz;
